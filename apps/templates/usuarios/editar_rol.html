{% extends "base/base.html" %}
{% load static %}
{% block title %}Editar Rol{% endblock %}

{% block content %}
<div class="card" style="width: 100%;">
    <div class="card-body">
        <h2>Editar Rol</h2>
        <form method="POST" action="">
            {% csrf_token %}
            <div class="form-group mb-3">
                <label for="name">Nombre del Rol</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ rol.name }}" required>
            </div>

            <div class="form-group mb-3">
                <label for="permissions">Permisos</label>
                <select id="permissions" name="permissions" multiple="multiple" class="form-control select2" style="width:100%;">
                    {% for permiso in permisos_json|safe|json_script:"permisos_data" %}
                    {% endfor %}
                </select>
            </div>

            <div class="text-center">
                <button type="submit" class="btn-crear mt-3">Guardar Cambios</button>
                <button type="button" class="btn-cancelar mt-3" onclick="window.location.href='{% url 'usuarios:roles' %}'">Cancelar</button
            </div>
        </form>
    </div>
</div>

<!-- InicializaciÃ³n de select2 -->
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/select2.min.js' %}"></script>
<link href="{% static 'css/select2.min.css' %}" rel="stylesheet" />

<script>
    $(document).ready(function() {
        const permisosData = {{ permisos_json|safe }};
        const permisosSeleccionados = {{ permisos_rol|safe }};
        
        $('#permissions').select2({
            data: permisosData,
            placeholder: "Selecciona los permisos",
            width: '100%'
        });

        // Preselecciona los permisos ya asignados
        $('#permissions').val(permisosSeleccionados).trigger('change');
    });
</script>
{% endblock %}
